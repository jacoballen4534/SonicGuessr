<div class="profile-edit-page">
  <div class="profile-form-card card-style">
    <h2 class="page-title">Edit Your Profile</h2>

    <div *ngIf="currentUser" class="current-profile-info">
      <img 
        [src]="currentUser.profile_image_url || 'assets/images/default-avatar.png'" 
        alt="Current Profile Picture" 
        class="profile-avatar">
      <div class="info-text">
        <p><strong>Google Name:</strong> {{ currentUser.display_name }}</p>
        <p *ngIf="currentUser.username"><strong>Current Username:</strong> {{ currentUser.username }}</p>
        <p><strong>Email:</strong> {{ currentUser.email }}</p>
      </div>
    </div>

    <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form" novalidate>
      <div class="form-field">
        <label for="username">Custom Username:</label>
        <input id="username" type="text" formControlName="username" placeholder="3-20 characters, letters/numbers">
        <div *ngIf="profileForm.get('username')?.invalid && (profileForm.get('username')?.dirty || profileForm.get('username')?.touched)" class="validation-error">
          <small *ngIf="profileForm.get('username')?.errors?.['minlength']">Username must be at least 3 characters long.</small>
          <small *ngIf="profileForm.get('username')?.errors?.['maxlength']">Username cannot be more than 20 characters.</small>
          <small *ngIf="profileForm.get('username')?.errors?.['pattern']">Username can only contain letters, numbers, and underscores.</small> 
        </div>
      </div>

      <div class="form-field">
        <label for="profile_image_url">Profile Image URL:</label>
        <input id="profile_image_url" type="url" formControlName="profile_image_url" placeholder="https://example.com/your-image.png">
        <div *ngIf="profileForm.get('profile_image_url')?.invalid && (profileForm.get('profile_image_url')?.dirty || profileForm.get('profile_image_url')?.touched)" class="validation-error">
          <small *ngIf="profileForm.get('profile_image_url')?.errors?.['pattern']">Please enter a valid URL (e.g., https://...).</small>
        </div>
        <img *ngIf="profileForm.get('profile_image_url')?.valid && profileForm.get('profile_image_url')?.value" 
             [src]="profileForm.get('profile_image_url')?.value" alt="New profile image preview" class="profile-image-preview">
      </div>

      <div class="form-actions">
        <button type="submit" class="button-cta" [disabled]="!profileForm.dirty || profileForm.invalid || isLoading">
          {{ isLoading ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </form>

    <app-feedback-display
        [message]="feedbackDisplay_message" 
        [type]="feedbackDisplay_type">
    </app-feedback-display>

  </div>
</div>