<div>
  <h2>Today's Challenge</h2>

  <div *ngIf="isLoading"><p>Loading songs...</p></div>
  <div *ngIf="error"><p style="color: red;">{{ error }}</p></div>

  <app-feedback-display
      [message]="feedbackDisplay_message"
      [type]="feedbackDisplay_type"
      [pointsAwarded]="feedbackDisplay_points"
      [correctAnswer]="feedbackDisplay_correctAnswer">
  </app-feedback-display>

  <div *ngIf="!isLoading && !error && !activeSong && dailySongs.length > 0 && !(feedbackDisplay_message && feedbackDisplay_message.includes('completed all songs'))">
    <button (click)="startChallengeWithFirstSong()">Start Challenge</button>
  </div>

  <div *ngIf="!isLoading && !error && dailySongs.length === 0 && !activeSong">
    <p>No songs available for today's challenge yet. Please check back later.</p>
  </div>

  <div *ngIf="activeSong">
    <h3>Playing Song #{{ activeSongIndex + 1 }} of {{ dailySongs.length }}</h3>
    <p><strong>Title Hint (Dev only):</strong> {{ activeSong.title }}</p>
    <p><strong>Artist Hint (Dev only):</strong> {{ activeSong.artist }}</p>
    <img *ngIf="activeSong.album_art_url" [src]="activeSong.album_art_url" alt="Album art" width="150">

    <p>Current Snippet Level: {{ SNIPPET_LEVELS[currentSnippetLevelIndex].durationText || 'N/A' }}</p>

    <button (click)="playCurrentSnippet()">Play Current Snippet</button>
    <button (click)="skipToNextSnippet()" 
            [disabled]="currentSnippetLevelIndex >= SNIPPET_LEVELS.length - 1 || !activeSong">
      Skip to Next Snippet 
      <span *ngIf="currentSnippetLevelIndex < SNIPPET_LEVELS.length - 1">
        ({{ SNIPPET_LEVELS[currentSnippetLevelIndex + 1].durationText }})
      </span>
      <span *ngIf="currentSnippetLevelIndex >= SNIPPET_LEVELS.length - 1">
        (No more)
      </span>
    </button>

    <app-guess-input (guessSubmitted)="handleUserGuess($event)"></app-guess-input>

    <button (click)="nextSong()" 
            *ngIf="activeSongIndex < dailySongs.length - 1"
            class="dev-next-song-button">
      Next Song (DEV - skip)
    </button>
  </div>

  <app-audio-player
    [videoId]="playbackVideoId"
    [startSeconds]="playbackStartSeconds"
    [endSeconds]="playbackEndSeconds">
  </app-audio-player>
</div>